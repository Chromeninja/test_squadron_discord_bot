#config/config-example.yaml
# This is an example configuration file for the Test Squadron Discord Bot.
# Copy this file to config/config.yaml and modify it with your settings.

bot:
  prefix: []

rate_limits:
  max_attempts: 5
  window_seconds: 1800        # 30 min rate-limit window
  recheck_window_seconds: 300 # 5 min recheck rate-limit window

logging:
  level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

voice:
  cooldown_seconds: 5  # Cooldown period for voice channel creation (seconds)
  expiry_days: 30      # Expiry period for inactive voice channel data (days)
  delete_delay_seconds: 10  # Delay before deleting empty voice channels (seconds)
  startup_delay_ms: 2000  # Delay after bot ready before reconciliation (milliseconds)
  startup_cleanup_mode: "delayed"  # How to handle empty channels on startup: "delayed" or "immediate"

database:
  path: "TESTDatabase.db"

bulk_announcement:
  hour_utc: 17                 # UTC hour to run the daily digest
  minute_utc: 13               # UTC minute to run the daily digest
  threshold: 50                 # Flush immediately if pending queue >= this size
  max_mentions_per_message: 50  # Max mentions per Discord message (avoid spam & limits)
  max_chars_per_message: 1800   # Max characters per message (safe under Discord 2000-char cap)

rsi:
  # Polite client hints
  user_agent: "TEST-Squadron-Verification-Bot/1.0 (+https://testsquadron.com)"
  # Global cap for ALL RSI HTTP calls (manual + auto)
  requests_per_minute: 30
  # Rate limiting settings
  cache_ttl_seconds: 300          # Cache RSI responses for 5 minutes
  max_concurrent_requests: 3      # Max concurrent RSI requests
  min_interval_seconds: 0.5       # Minimum spacing between RSI requests

  # Circuit breaker for 403 Forbidden responses
  # When RSI blocks us (anti-bot, rate limit), the circuit opens and
  # requests fail fast until a cooldown period expires.
  circuit_breaker:
    threshold: 3                  # Consecutive 403s before opening circuit
    reset_timeout: 300            # Seconds before allowing a probe request (5 min)
    backoff_base: 60              # Base backoff in seconds for exponential growth
    backoff_max: 3600             # Maximum backoff cap (1 hour)


auto_recheck:
  enabled: true

  # How often to recheck each category (days)
  cadence_days:
    main: 14
    affiliate: 7
    non_member: 3

  # Spread scheduling to avoid thundering herds
  jitter_hours: 12

  # Batch processing
  batch:
    run_every_minutes: 60       # wake up hourly
    max_users_per_run: 30       # re-check at most 30 users per run (safe margin under RSI limits)
    startup_delay_minutes: 5    # wait after bot start before first auto-check run
    per_user_delay_seconds: 1.5 # delay between processing each user (pacing)
    ramp_up_runs: 3             # number of runs before reaching full batch size

  # Backoff when RSI fetch fails (network, 5xx, etc.)
  backoff:
    base_minutes: 180           # 3 hours
    max_minutes: 1440           # 24 hours