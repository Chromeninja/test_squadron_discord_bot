version: '3.8'

services:
  # FastAPI Backend
  web_api:
    build:
      context: ./web/backend
      dockerfile: Dockerfile
    ports:
      - "8081:8081"
    environment:
      - DISCORD_CLIENT_ID=${DISCORD_CLIENT_ID}
      - DISCORD_CLIENT_SECRET=${DISCORD_CLIENT_SECRET}
      - DISCORD_REDIRECT_URI=${DISCORD_REDIRECT_URI}
      - SESSION_SECRET=${SESSION_SECRET}
    volumes:
      - ./web/backend:/app
      - ./config:/app/config:ro
      - ./services:/app/services:ro
      - ./data:/app/data
    depends_on:
      - db
    networks:
      - app-network

  # React Frontend
  frontend:
    build:
      context: ./web/frontend
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    environment:
      - VITE_API_BASE=http://localhost:8081
    volumes:
      - ./web/frontend:/app
      - /app/node_modules
    depends_on:
      - web_api
    networks:
      - app-network

  # SQLite Database (optional - using volume for persistence)
  db:
    image: alpine:latest
    volumes:
      - ./data:/data
    command: tail -f /dev/null
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  data:
